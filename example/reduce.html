<script src="../tinytest.js"></script>
<script>
    // Prototype implementation:
    function reduce(array, callback, startingValue) {
        var accumulator = arguments.length === 3 ? startingValue : array[0];
        var startingIndex = arguments.length === 3 ? 0 : 1;

        for (var i = startingIndex; i < array.length; i++) {
            if (array[i]) {
                accumulator = callback(accumulator, array[i], i, array);
            }
        }
        return accumulator;
    }

    // Function signature:
    // reduce(array, callback[, initialValue])

    // callback parameters:
    // accumulator
    // currentValue
    // currentIndex
    // array

    // Returns a single value.

    tests({
        'If initialValue, callback should run array.length times.': function () {
            var numbersOfTimeCallbackHasRun = 0;
            reduce([1, 2, 3], function () {
                numbersOfTimeCallbackHasRun++;
            }, 0);
            eq(numbersOfTimeCallbackHasRun, 3);
        },
        'It no initialValue, callback should run array.length - 1 times.': function () {
            var numbersOfTimeCallbackHasRun = 0;
            reduce([1, 2, 3], function () {
                numbersOfTimeCallbackHasRun++;
            });
            eq(numbersOfTimeCallbackHasRun, 2);
        },
        'If initialValue, accumulator should start with initialValue.': function () {
            reduce([1], function (acc, current) {
                eq(acc, 0);
            }, 0);
        },
        'If initialValue, currentValue should start with array[0].': function () {
            reduce([1], function (acc, current) {
                eq(current, 1);
            }, 2);
        },
        'If initialValue, callback will start at index 0, wich is the first element.': function () {
            reduce([1], function (acc, current, currentIndex) {
                eq(currentIndex, 0);
            }, 2);
        },
        'If no initialValue, accumulator should start with array[0].': function () {
            reduce([1, 2], function (acc, current, currentIndex) {
                eq(acc, 1);
            });
        },
        'If no initialValue, currentValue should start with array[1]': function () {
            reduce([1, 2], function (acc, current, currentIndex) {
                eq(current, 2);
            });
        },
        'If no initialValue, callback will start at index 1.': function () {
            reduce([1, 2], function (acc, current, currentIndex) {
                eq(currentIndex, 1);
            });
        },
        'If initialValue, and array is emmty, it should return initialValue without calling callback.': function () {
            var numbersOfTimeCallbackHasRun = 0;
            var reducedValue = reduce([, ,], function () {
                numbersOfTimeCallbackHasRun++;
            }, 5);
            eq(numbersOfTimeCallbackHasRun, 0);
            eq(reducedValue, 5);
        },
        'If no initialValue, and array has one element, it should return that element without calling callback.': function () {
            var numbersOfTimeCallbackHasRun = 0;
            var reducedValue = reduce([6], function () {
                numbersOfTimeCallbackHasRun++;
            });
            eq(numbersOfTimeCallbackHasRun, 0);
            eq(reducedValue, 6);
        },
        'It should actually reduce.': function () {
            var reducedValue = reduce([1, 2, 8], function (acc, current, currentIndex) {
                return acc + current;
            }, 0);
            eq(reducedValue, 11);
        },
        'It should excludes holes.': function () {
            var reducedValue = reduce([1, 2, 8], function (acc, current, currentIndex) {
                return acc + current;
            }, 0);
            eq(reducedValue, 11);
        },
        'If array is empty, and no initialValue, throw TypeError.': function () {
            fail();
        },
        'It should pass array as fourth argument to callback.': function () {
            var array = [];
            reduce([1, 2], function (acc, current, currentIndex, array) {
                eq(arguments.length, 4);
                eq(Array.isArray(array), true);
            });
        }
    });















</script>